<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <link rel="stylesheet" href="treeStyle.css">
  <style>

    .node rect {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
        border-radius: 10px; /* rounded corners */
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* subtle shadow */
        
        
        
    }

    .node:hover rect {
        fill: #e6f7ff;
        stroke: #1890ff;
    }


    .node text {
        font: 20px 'Segoe UI', sans-serif; /* updated font */
        fill: #333;
        cursor: pointer;

    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
        opacity: 1;
        transition: all 0.5s ease-in-out;

    }

    .link.hidden {
        opacity: 0;
    }

    body {
        margin: 0;
        overflow: hidden; /* Hide any potential scrollbars */
    }

    .container {
        display: flex;
        justify-content: center;
        height: 100vh; /* Use the full height of the viewport */
        
    }

    .tree-container {
        flex: 0 1 80%; 
        max-width: 1200px;
        overflow: auto;
        background-color: #ffffff;
        margin-top:200px;
        margin-left:120px;
        
        
        
    }

    .shopping-cart {
    
        stroke: darkgreen;
        stroke-width: 2;
        position: absolute;
        width: 150px; 
        height: px; 
        transform: translateY(360%);
    }



  </style>
</head>

<body>
      <div class="top-section-container">
        <h2 style = " color: #707070; font-size: 2em;   padding: 20px;  ">Welcome, User</h2>
        <button id="Sign-Out">Sign Out</button>
    </div>
   
    <div class = "search-left-container">
        <h2><i class="fas fa-magnifying-glass"></i> Search</h2>
    </div>
    <div class = "tree-left-container " style="background-color: orange;"">
        <h2><i class="fa-solid fa-share-nodes"></i></i> Tree</h2>
    </div>
    <div class = "account-left-container">
        <h2><i class="fa-regular fa-user"></i> Account</h2>
    </div>
  <div class="container">
      
    <div class="tree-container">
      
      <!-- Tree SVG will be appended here -->
      <script>
        // Your existing JavaScript code for the tree
        var data = {
          "name": "Computer Science",
          "children": [{
              "name": "Year 1",
              "children": [{
                  "name": "COMP 1010",
                  "children": [{
                    "name": "Introduction to CS"
                  }]
                },
                {
                  "name": "COMP 1012",
                  "children": [ {
                    "name": "Intro to CS for Engineers"
                  }]
                },
                {
                  "name": "COMP 1020",
                 
                }    
              ]
            },
            {
              "name": "Year 2",
              "children": [{
                  "name": "COMP 2080"
                },{
                  "name": "COMP 2140",
                  "children": [{
                    "name": "Introduction to Algorithms"
                  },
                ]
                },
                
                {
                  "name": "COMP 2150"
                }, 
                {
                  "name": "COMP 2160",
                  "children": [{
                    "name": "C for Beginners"
                  },
                ]
                },
                {
                  "name": "COMP 2280",
                }
                   
              ]
            },
            {
              "name": "Year 3",
              "children": [{
                  "name": "COMP 3010",
                  "children": [{
                    "name": "Intro to Distributed Computing"
                  },]
                },
                {
                  "name": "COMP 3020",
                },  
                {
                  "name": "COMP 3030",
                }, 
                {
                  "name": "COMP 3190",
                  "children": [{
                    "name": "Artificial Intelligence For Dummies"
                  },]
                  
                },
               
                  
              ]
            },
            {
              "name": "Year 4",
              "children": [{
                  "name": "COMP 4020",
                 
                },
                {
                  "name": "COMP 4350",
                },  
                {
                  "name": "COMP 4360",
                  "children": [{
                    "name": "Advanced Machine Learning"
                  },]
                }, 
                
                
                  
              ]
            
            }
          ]
        };

        var margin = {
          top: 20,
          right: 120,
          bottom: 20,
          left: 120
        },
        width = 960 - margin.right - margin.left,
        height = 400 - margin.top - margin.bottom;

        var i = 0,
        duration = 100,
        root;

        var tree = d3.tree().size([width, height]);

        var diagonal = d3.linkVertical()
          .x(function (d) {
            return d.x;
          })
          .y(function (d) {
            return d.y;
          });

        var svg = d3.select(".tree-container").append("svg")
          .attr("width", width + margin.right + margin.left)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        root = d3.hierarchy(data);
        root.x0 = width / 2;
        root.y0 = 0;

        // Initially hide children of Year nodes
        root.children.forEach(collapse);

        update(root);

        d3.select(self.frameElement).style("height", "500px");
        
        var shoppingCart = {
          name: "Shopping Cart",
          children: []
        };

        function collapse(d) {
          if (d.children) {
            d._children = d.children;
            d._children.forEach(collapse);
            d.children = null;
          }
        }

        var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function (d) {
            return d.id;
          }).strength(2))
          .force("charge", d3.forceManyBody().strength(-50))
          .force("center", d3.forceCenter(width / 2, height / 2));

        function update(source) {
          // Compute the new tree layout.
          var nodes = tree(root).descendants(),
            links = tree(root).links();

          // Declare the links…
          var link = svg.selectAll("path.link")
            .data(links, function (d) {
              return d.target.id;
            });

          // Enter the links.
          link.enter().insert("path", "g")
            .attr("class", "link")
            .attr("d", function (d) {
              return diagonal(d); // Use the diagonal function directly with the data
            });

          // Update the display of nodes and links.
          link.transition()
            .duration(duration)
            .attr("d", diagonal)
            .style("opacity", 1)
            .attr("class", function (d) {
              return "link" + (d.target.children || d.target._children ? "" : " hidden");
            });

          link.exit().transition()
            .duration(duration)
            .style("opacity", 0)
            .remove();

          // Declare the nodes…
          var node = svg.selectAll("g.node")
            .data(nodes, function (d) {
              return d.id;
            });
          var initialX = null;
          var initialY = null;
          // Enter the nodes.
          var nodeEnter = node.enter().append("g")
            .attr("class", "node")
            .attr("transform", function (d) {
              return "translate(" + d.x + "," + d.y + ")";
            })
            .on("click", function (d) {
              toggle(d);
              update(d);
            })
            .call(d3.drag()
              .on("start", function (d) {
                if (isLeafNode(d)) {
                  if (!d.dragStarted) {
                    d.dragStarted = true;
                    initialX = d.x;
                    initialY = d.y;
                    d3.select(this).classed("dragging", true); // Add dragging class
                  }
                }
              })
              .on("drag", function (d) {
                if (isLeafNode(d) && d.dragStarted) {
                  d.x += d3.event.dx;
                  d.y += d3.event.dy;
                  d3.select(this).attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                  });
                }
              })
              .on("end", function (d) {
                if (isLeafNode(d) && d.dragStarted) {
                  d.dragStarted = false;
                  d.x = initialX;
                  d.y = initialY;
                  d3.select(this).transition().duration(500).attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                  });
                }
              }));

          nodeEnter.append("rect")
            .attr("width", function (d) {
              return d.data.name.length * 8;
            })
            .attr("height", 20)
            .attr("x", function (d) {
              return -(d.data.name.length * 4);
            })
            .attr("y", -10)
            .style("fill", "#fff");

          nodeEnter.append("text")
            .attr("x", 0)
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .text(function (d) {
              return d.data.name;
            })
            .style("fill-opacity", 1)
            .each(function (d) {
              // Get the length of the text
              var textLength = this.getComputedTextLength();

              // Add some padding and set a minimum width
              var rectWidth = Math.max(textLength + 10, 40);

              d3.select(this.parentNode).select("rect")
                .attr("width", rectWidth)
                .attr("height", 20)
                .attr("x", -rectWidth / 2)
                .attr("y", -10);
            });

          // Update the display of nodes.
          node.transition()
            .duration(duration)
            .attr("transform", function (d) {
              return "translate(" + d.x + "," + d.y + ")";
            })
            .style("opacity", 1);

          // Exit the nodes.
          node.exit()
            .transition()
            .duration(duration)
            .style("opacity", 0)
            .remove();
        }

        function isLeafNode(d) {
          return !d.children && !d._children;
        }

        function toggle(d) {
          if (d.children) {
            d._children = d.children;
            d.children = null;
          } else {
            // Collapse all other year children
            if (d.parent) {
              d.parent.children.forEach(function (child) {
                if (child !== d && child.children) {
                  collapse(child);
                }
              });
            }
            d.children = d._children;
            d._children = null;
          }
        }

      </script>
    </div>
    <div>
      <script>
        var cartGroup = d3.select(".tree-container").append("svg")
          .attr("class", "shopping-cart")
          .attr("width", 150) // Adjust the width as needed
          .attr("height", 200) // Adjust the height as needed
          .attr("style", "position: absolute; top: 0; right: 0;");
      
        cartGroup.append("rect")
          .attr("width", 150) // Adjust the width as needed
          .attr("height", 200) // Adjust the height as needed
          .style("fill", "#fff")
          .style("stroke", "black");
      
        cartGroup.append("text")
          .attr("x", 75) // Adjust the x-position as needed
          .attr("y", 20)
          .attr("text-anchor", "middle")
          .text("Cart");
      
        // Container for displaying items
        var itemsContainer = cartGroup.append("g")
          .attr("class", "items-container")
          .attr("transform", "translate(10, 40)"); // Adjust the translation as needed
      
        // Event listener for the tree container to capture clicks and add to the cart
        d3.select(".tree-container")
          .on("mousemove", function () {
            var draggedNode = d3.select(".node.dragging").node();
            if (draggedNode) {
              var mouseX = d3.event.clientX;
              var mouseY = d3.event.clientY;

              // Check if the mouse is inside the shopping cart area
              var cartRect = cartGroup.node().getBoundingClientRect();
              if (
                mouseX > cartRect.left &&
                mouseX < cartRect.right &&
                mouseY > cartRect.top &&
                mouseY < cartRect.bottom
              ) {
                // Check if the dragged node is a leaf node
                if (isLeafNode(draggedNode.__data__)) {
                  // Add the course to the shopping cart
                  var draggedItem = draggedNode.__data__.data;

                  // Check if the item is already in the cart
                  var existingItem = shoppingCart.children.find(item => item.name === draggedItem.name);

                  if (existingItem) {
                    // Item already in the cart, increase quantity
                    existingItem.quantity = (existingItem.quantity || 1) + 1;
                  } else {
                    // Item not in the cart, add it with quantity 1
                    draggedItem.quantity = 1;
                    shoppingCart.children.push({ ...draggedItem });
                  }
                  updateCartItems();
                }

                // Reset the dragging class
                d3.select(".node.dragging").classed("dragging", false);
              }
            }
          });
      
        // Function to update the display of items in the cart
        // Function to update the display of items in the cart
      function updateCartItems() {
        var items = itemsContainer.selectAll(".cart-item").data(shoppingCart.children);
        items.exit().remove();

        // Update existing items
        items.select(".quantity-text").text(function (d) {
          return d.name + "   Qty: " + d.quantity;
        });

        // Create new items
        var newItem = items.enter().append("g")
          .attr("class", "cart-item")
          .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; })
          .on("mouseover", function (d) {
            d3.select(this).select(".quantity-controls").style("display", "inline");
          })
          .on("mouseout", function (d) {
            d3.select(this).select(".quantity-controls").style("display", "none");
          });

        // Display name and quantity for both existing and new items
        newItem.append("text")
          .attr("class", "quantity-text")
          .attr("text-anchor", "start")
          .text(function (d) {
            return d.name + "   Qty: " + d.quantity;
          });

        // Add buttons for quantity control
        var controls = newItem.append("g")
          .attr("class", "quantity-controls")
          .style("display", "none");
        
        controls.append("text")
        .attr("class", "control-button")
        .attr("x", 65)
        .attr("y", 0) // Adjust the y-position as needed
        .text("-")
        .on("click", function (d) {
          // Decrease quantity on button click
          d.quantity = Math.max(1, (d.quantity || 1) - 1);
          updateCartItems();
        });

        controls.append("text")
          .attr("class", "control-button")
          .attr("x", 120)
          .attr("y", 0) // Adjust the y-position as needed
          .text("+")
          .on("click", function (d) {
            // Increase quantity on button click
            d.quantity = (d.quantity || 1) + 1;
            updateCartItems();
          });

        

        // Merge the new items with the existing items
        items = items.merge(newItem);
      }

        document.getElementById("Sign-Out").addEventListener('click',() =>{
        window.location.href = "../login-signup/login.html"
        });

        document.querySelector('.search-left-container').addEventListener('click', function(){
        window.location.href = "../search-files/search.html";
        });
        
        document.querySelector('.tree-left-container').addEventListener('click', function(){
          window.location.href = "../tree-struct/tree.html";
        });
        
        document.querySelector('.account-left-container').addEventListener('click', function(){
          window.location.href = "../account/account.html";
        });
      </script>
    </div>
  </div>
</body>

</html>
